- name: Initialize isucon10
  become: yes
  become_user: isucon
  command: curl -X POST http://localhost/initialize
- name : Snapshot isucon10
  become: yes
  become_user: isucon
  args:
    chdir: /home/isucon/isucon10-qualify/initial-data/
  environment:
    PATH: "/home/isucon/bin:/home/isucon/.local/bin:/usr/local/node/bin:/usr/local/python/bin:/usr/local/go/bin:/home/isucon/go/bin:/usr/local/bin:/usr/bin:/bin"
  shell: |
    go build -o ./make_verification_data/main ./make_verification_data/*.go && ./make_verification_data/main -dest-dir ./result/verification_data -target-url http://localhost:1323


- name: Build benchmarker
  become: yes
  become_user: isucon
  args:
    chdir: /home/isucon/isucon10-qualify/bench/
  environment:
    PATH: "/home/isucon/bin:/home/isucon/.local/bin:/usr/local/node/bin:/usr/local/python/bin:/usr/local/go/bin:/home/isucon/go/bin:/usr/local/bin:/usr/bin:/bin"
  shell: |
    make && ./bench -data-dir ../initial-data -target-url "http://localhost"

- name: Disable Unused Services
  become: yes
  become_user: root
  shell: |
    systemctl disable isucon-go && \
    systemctl disable mysql && \
    systemctl disable nginx
